{% extends "base.html" %}

{% block title %}Edit Survey{% endblock %}

{% block head %}
    {{ super() }}
    <script type="text/javascript">
        var survey_id = '{{ survey._id }}';
        var survey_times = {{ survey.timings }};
        var survey_content = '{{ survey.content|tojson }}';
    </script>
    <script src="../static/javascript/survey-editor/handlebars-question-rendering.js"></script>
    <script src="../static/javascript/survey-editor/radiobutton-checkbox-questions.js"></script>
    <script src="../static/javascript/survey-editor/set-up-modal.js"></script>
    <script src="../static/javascript/survey-editor/question-from-modal.js"></script>
    <script src="../static/javascript/survey-editor/schedule.js" type="text/javascript"></script>
    <script src="../static/javascript/survey-editor/survey-editor.js"></script>
    <link rel="stylesheet" href="../static/css/survey_builder.css"  type="text/css"/>

    <script type="text/javascript">
      var tracking_survey = false;
    </script>
{% endblock %}

{% block content %}

    <ol class="breadcrumb">
      <li>
        <a href="/view_study/{{ study['_id'] }}">{{ study['name'] }}</a>
      </li>
      <li class="active">
        {{ "Audio" if survey['survey_type'] == 'audio_survey' }} Survey ID #{{ survey['_id'] }}
      </li>
    </ol>

    <div class="container">

      <div class="span12">
        <div class="row">
          <h2>Edit Survey</h2>
          <p>Survey ID #<b>{{ survey._id }}</b>. Your changes will not be saved until you click "Save and Deploy."</p>
          <button type="submit" class="btn btn-success btn-lg save_and_deploy_button" onclick="end(); return false;">
            <span class="glyphicon glyphicon-upload"></span>Save & Deploy
          </button>
        </div>
        <hr>

        {% include 'survey_schedule.html' %}
        <div id="surveySchedule"></div>
        <hr>

        {% if survey.survey_type == 'tracking_survey' %}
          <div class="row">
            <h3>Questions</h3>
            <script type="text/javascript">
              tracking_survey = true;
            </script>
            {% include 'question_summary.html' %}
            <div id="listOfCurrentQuestions"></div>
            <br>
            <div id="newQuestions">
            </div>
            <br>
              <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#editQuestionModal" onclick="clearModal(); return false;">
              <span class="glyphicon glyphicon-plus"></span>Add Question
              </button>
        	{% include 'randomize_questions.html' %}
          </div>

        {% elif survey.survey_type == 'audio_survey' %}
          <div class="row">
            <h3>Voice Recording Prompt</h3>
            <input id="voice_recording_prompt_text_input" type="text" class="form-control" value="{% if survey.content[0] %}{{survey.content[0]['prompt']}}{% endif %}">
          </div>
          <hr>
          <div class="row">
            <h3>Technical Settings</h3>
            <div class="well well-sm">
              <p>Audio recordings contain a single channel and are made using the active microphone on the device, which may may be on a connected headset.  Older versions of the Beiwe App will make compressed recordings at 64Kbps.</p>

              <p><b>Compressed</b> audio files use AAC compression. 64Kbps should be sufficient for a vocal recording under nearly all situations, and produces roughly <b>one half of a megabyte </b> of data for each minute of audio. The sample rate of a compressed recording is always 44,100Hz. </p>

              <p><b>Uncompressed</b> audio recordings produce wav files. A wav file with a sample rate of 44,100 ("CD quality") has a bit rate equivalence of 706Kbps, or roughly <b>five megabytes</b> of data for each minute of audio.</p>
              </div>

            <input type="radio" name="audio_survey_type" id="radio_compressed" value="compressed" onclick="audioSurveyTypeChange('compressed')" {{ 'checked' if survey.settings['audio_survey_type'] == 'compressed' }}>
            <label for="radio_compressed"> Compressed audio&nbsp;&nbsp;&nbsp; </label>
            
            <input type="radio" name="audio_survey_type" value="raw" id="radio_uncompressed" onclick="audioSurveyTypeChange('raw')"  {{ 'checked' if survey.settings['audio_survey_type'] == 'raw' }} > 
            <label for="radio_uncompressed"> Uncompressed audio&nbsp;&nbsp;&nbsp; </label>
            
            <select id="compressed_options" name="bit_rate" >
                <option value="32000" {{ 'selected' if survey.settings['bit_rate'] == 32000 }}>32Kbps</option>
                <option value="64000" {{ 'selected' if survey.settings['bit_rate'] == 64000 or not survey.settings['bit_rate'] }}>64Kbps</option>
                <option value="96000" {{ 'selected' if survey.settings['bit_rate'] == 96000 }}>96Kbps</option>
                <option value="128000" {{ 'selected' if survey.settings['bit_rate'] == 128000 }}>128Kbps</option>
            </select>

            <select id="raw_options" name="sample_rate" >
                <option value="16000" {{ 'selected' if survey.settings['sample_rate'] == 16000 }}>16,000Hz</option>
                <option value="22050" {{ 'selected' if survey.settings['sample_rate'] == 22050 }}>22,050Hz</option>
                <option value="44100" {{ 'selected' if survey.settings['sample_rate'] == 44100 or not survey.settings['sample_rate'] }}>44,100Hz</option>      
            </select>
        </div>
        
        {% endif %}

        <hr><br>
        <div class="row">
          <button type="submit" class="btn btn-success btn-lg save_and_deploy_button" onclick="end(); return false;">
          <span class="glyphicon glyphicon-upload"></span>Save & Deploy
          </button>
          <a class="btn btn-lg btn-danger pull-right" href="/delete_survey/{{ survey._id }}" onclick="return confirm('Are you sure you want to delete this survey? The survey questions will be lost forever, and if you want them back, you will have to re-create the survey from scratch. Also, people in the study will no longer get notifications for this survey or be able to answer it.')">
          <span class="glyphicon glyphicon-trash"></span>Delete survey</a>
        </div>

      </div>
    </div>

    {% include 'edit_question.html' %}

{% endblock %}